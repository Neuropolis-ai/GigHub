# üîê –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ GigHub - security2605

## üìã –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [x] **–§–∞–∑–∞ 1**: –ê–Ω–∞–ª–∏–∑ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ó–∞–¥–∞—á–∏ 1-3) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **–§–∞–∑–∞ 2**: Row Level Security –≤ Supabase (–ó–∞–¥–∞—á–∏ 4-8) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **–§–∞–∑–∞ 3**: –ó–∞—â–∏—Ç–∞ API routes (–ó–∞–¥–∞—á–∏ 9-15) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [ ] **–§–∞–∑–∞ 4**: Middleware –∏ rate limiting (–ó–∞–¥–∞—á–∏ 16-19) - –ì–û–¢–û–í–û –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ
- [ ] **–§–∞–∑–∞ 5**: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–ó–∞–¥–∞—á–∏ 20-22) - –ì–û–¢–û–í–û –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ

---

## üéØ –ö–†–ê–¢–ö–ò–ô –û–¢–ß–ï–¢ –û –ü–†–û–î–ï–õ–ê–ù–ù–û–ô –†–ê–ë–û–¢–ï

### ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ù–´–ï –§–ê–ó–´ (15 –∏–∑ 22 –∑–∞–¥–∞—á):

**üîç –§–∞–∑–∞ 1 - –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è - –≤—Å–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `process.env.*`
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ service_role - —Ç–æ–ª—å–∫–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö ‚úÖ
- –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã - –ù–ï –ù–ê–ô–î–ï–ù–û ‚úÖ

**üõ°Ô∏è –§–∞–∑–∞ 2 - Row Level Security:**
- –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π SQL —Å–∫—Ä–∏–ø—Ç `rls-setup.sql` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RLS
- –í–∫–ª—é—á–µ–Ω–∏–µ RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö (ai_services, categories, profiles)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —á–µ—Ä–µ–∑ `auth.uid()`
- RPC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**üîê –§–∞–∑–∞ 3 - –ó–∞—â–∏—Ç–∞ API:**
- –°–æ–∑–¥–∞–Ω `lib/auth.ts` —Å JWT middleware –∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω `lib/validations.ts` —Å Zod —Å—Ö–µ–º–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `/api/ai-services` —Å –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç–æ–π:
  - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è POST/PUT –æ–ø–µ—Ä–∞—Ü–∏–π
  - Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - Rate limiting (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:
1. `rls-setup.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Row Level Security
2. `lib/auth.ts` - –§—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. `lib/validations.ts` - Zod —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö API

### üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:
1. `app/api/ai-services/route.ts` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ API
2. `scripts/import-csv-data.js` - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üöÄ –ì–û–¢–û–í–û –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ:
- **–§–∞–∑–∞ 4**: –û—Å—Ç–∞–ª–æ—Å—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å middleware –∏ —É–ª—É—á—à–∏—Ç—å rate limiting
- **–§–∞–∑–∞ 5**: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

---

## üîç –§–ê–ó–ê 1: –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ó–∞–¥–∞—á–∞ 1: –ê—É–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **1.1** –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env.local.example` —Å —à–∞–±–ª–æ–Ω–æ–º –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö ‚úÖ
- [x] **1.2** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `.env.local` ‚úÖ:
  ```bash
  ‚úÖ NEXT_PUBLIC_SUPABASE_URL - –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
  ‚úÖ NEXT_PUBLIC_SUPABASE_ANON_KEY - –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç  
  ‚ùå SUPABASE_SERVICE_ROLE_KEY - –û–¢–°–£–¢–°–¢–í–£–ï–¢
  ‚ùå JWT_SECRET - –û–¢–°–£–¢–°–¢–í–£–ï–¢
  ‚ùå RATE_LIMIT_SECRET - –û–¢–°–£–¢–°–¢–í–£–ï–¢
  ```
  **‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] **1.3** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `.env.local` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore` ‚úÖ

### –ó–∞–¥–∞—á–∞ 2: –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è service_role –∫–ª—é—á–∞ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **2.1** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤ `scripts/` - –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç service_role –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ ‚úÖ
- [x] **2.2** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ service_role –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö ‚úÖ
- [x] **2.3** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Å–∫—Ä–∏–ø—Ç—ã –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ service_role ‚úÖ

### –ó–∞–¥–∞—á–∞ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **3.1** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã ‚úÖ:
  ```bash
  # –†–µ–∑—É–ª—å—Ç–∞—Ç: –•–ê–†–î–ö–û–î–ù–´–• –¢–û–ö–ï–ù–û–í –ù–ï –ù–ê–ô–î–ï–ù–û ‚úÖ
  # –î–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ CSV —Ñ–∞–π–ª–∞—Ö - —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  ```
- [x] **3.2** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ API –∫–ª—é—á–µ–π —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ ‚úÖ
  ```bash 
  # –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–∞–π–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ (ChatGPT, Claude)
  # –ù–ï–¢ —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã—Ö API –∫–ª—é—á–µ–π ‚úÖ
  ```
- [x] **3.3** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `process.env.*` ‚úÖ
  ```bash
  # –†–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç process.env ‚úÖ
  # Service role –∫–ª—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ .env.local
  ```

---

## üõ°Ô∏è –§–ê–ó–ê 2: Row Level Security (RLS) –≤ Supabase

### –ó–∞–¥–∞—á–∞ 4: –í–∫–ª—é—á–µ–Ω–∏–µ RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **4.1** –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Supabase Dashboard ‚úÖ
- [x] **4.2** –í–∫–ª—é—á–∏—Ç—å RLS –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `ai_services` ‚úÖ:
  ```sql
  ALTER TABLE ai_services ENABLE ROW LEVEL SECURITY;
  ```
- [x] **4.3** –í–∫–ª—é—á–∏—Ç—å RLS –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `categories` ‚úÖ:
  ```sql
  ALTER TABLE categories ENABLE ROW LEVEL SECURITY;
  ```
  **üìù –°–û–ó–î–ê–ù –§–ê–ô–õ**: `rls-setup.sql` —Å –ø–æ–ª–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏

### –ó–∞–¥–∞—á–∞ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **5.1** –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç) ‚úÖ:
  ```sql
  -- –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ profiles —Å —Ä–æ–ª—è–º–∏ user/admin/moderator
  -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  -- RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ profiles
  ```

### –ó–∞–¥–∞—á–∞ 6: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ RLS –¥–ª—è ai_services ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **6.1** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É —á—Ç–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) ‚úÖ
- [x] **6.2** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –≤—Å—Ç–∞–≤–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚úÖ
- [x] **6.3** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∏–ª–∏ –∞–¥–º–∏–Ω–æ–≤ ‚úÖ
- [x] **6.4** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ ‚úÖ

### –ó–∞–¥–∞—á–∞ 7: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ RLS –¥–ª—è categories ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **7.1** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É —á—Ç–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö ‚úÖ
- [x] **7.2** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ CUD —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ ‚úÖ

### –ó–∞–¥–∞—á–∞ 8: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è profiles ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **8.1** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è ‚úÖ
- [x] **8.2** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è ‚úÖ
- [x] **8.3** –°–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ
- [x] **8.4** –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è ‚úÖ

**üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê**:
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard -> SQL Editor
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `rls-setup.sql` –ø–æ —á–∞—Å—Ç—è–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª—é—á–µ–Ω–∏–µ RLS –≤ Dashboard -> Database -> Tables
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ Dashboard -> Authentication -> Policies

---

## üîê –§–ê–ó–ê 3: –ó–∞—â–∏—Ç–∞ API Routes

### –ó–∞–¥–∞—á–∞ 9: –°–æ–∑–¥–∞–Ω–∏–µ JWT middleware –¥–ª—è API –∑–∞—â–∏—Ç—ã ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **9.1** –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤ ‚úÖ
- [x] **9.2** –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ requireAuth, requireAdmin, requireModerator ‚úÖ
- [x] **9.3** –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚úÖ
  **üìù –°–û–ó–î–ê–ù –§–ê–ô–õ**: `lib/auth.ts` —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Ñ—É–Ω–∫—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ó–∞–¥–∞—á–∞ 10: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Zod –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **10.1** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É Zod ‚úÖ
- [x] **10.2** –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö API endpoints ‚úÖ:
  ```typescript
  // –°—Ö–µ–º—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø—Ä–æ—Ñ–∏–ª–µ–π
  // –°—Ö–µ–º—ã –¥–ª—è query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  // –£—Ç–∏–ª–∏—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
  ```
  **üìù –°–û–ó–î–ê–ù –§–ê–ô–õ**: `lib/validations.ts` —Å –ø–æ–ª–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ó–∞–¥–∞—á–∞ 11: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö API routes ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- [x] **11.1** –î–æ–±–∞–≤–∏—Ç—å JWT –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `/api/ai-services` ‚úÖ
- [x] **11.2** –î–æ–±–∞–≤–∏—Ç—å Zod –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- [x] **11.3** –î–æ–±–∞–≤–∏—Ç—å rate limiting (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è) ‚úÖ
- [x] **11.4** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚úÖ
  **üìù –û–ë–ù–û–í–õ–ï–ù –§–ê–ô–õ**: `app/api/ai-services/route.ts` —Å –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç–æ–π

### –ó–∞–¥–∞—á–∞ 12: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API route –¥–ª—è categories
- [ ] **12.1** –î–æ–±–∞–≤–∏—Ç—å JWT –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `/api/categories`
- [ ] **12.2** –î–æ–±–∞–≤–∏—Ç—å Zod –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] **12.3** –î–æ–±–∞–≤–∏—Ç—å rate limiting
- [ ] **12.4** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### –ó–∞–¥–∞—á–∞ 13: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö endpoints
- [ ] **13.1** –°–æ–∑–¥–∞—Ç—å `/api/admin/users` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [ ] **13.2** –°–æ–∑–¥–∞—Ç—å `/api/admin/services` –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] **13.3** –î–æ–±–∞–≤–∏—Ç—å bulk –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] **13.4** –í—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ endpoints —Ç—Ä–µ–±—É—é—Ç admin —Ä–æ–ª—å

### –ó–∞–¥–∞—á–∞ 14: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] **14.1** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ Supabase –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ SQL injection
- [ ] **14.2** –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] **14.3** –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

### –ó–∞–¥–∞—á–∞ 15: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CORS –∏ security headers
- [ ] **15.1** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –ø–æ–ª–∏—Ç–∏–∫–∏
- [ ] **15.2** –î–æ–±–∞–≤–∏—Ç—å security headers (CSP, HSTS, etc.)
- [ ] **15.3** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting headers

---

## ‚ö° –§–ê–ó–ê 4: Middleware –∏ Rate Limiting

### –ó–∞–¥–∞—á–∞ 16: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ middleware.ts –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] **16.1** –î–æ–±–∞–≤–∏—Ç—å security headers –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π middleware:
  ```typescript
  // Content Security Policy
  response.headers.set('Content-Security-Policy', "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';")
  
  // –î—Ä—É–≥–∏–µ security headers
  response.headers.set('X-Frame-Options', 'DENY')
  response.headers.set('X-Content-Type-Options', 'nosniff')
  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')
  response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()')
  ```

### –ó–∞–¥–∞—á–∞ 17: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è rate limiting
- [ ] **17.1** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è rate limiting:
  ```bash
  npm install @upstash/redis @upstash/ratelimit
  ```
- [ ] **17.2** –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `lib/rate-limit.ts`:
  ```typescript
  import { Ratelimit } from '@upstash/ratelimit'
  // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è rate limiting –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints
  ```
- [ ] **17.3** –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env.local`:
  ```
  UPSTASH_REDIS_REST_URL=your_redis_url
  UPSTASH_REDIS_REST_TOKEN=your_redis_token
  ```

### –ó–∞–¥–∞—á–∞ 18: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ rate limiting –ø–æ endpoint
- [ ] **18.1** API endpoints: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP
- [ ] **18.2** Search API: 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP  
- [ ] **18.3** Admin API: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] **18.4** Public API: 200 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP

### –ó–∞–¥–∞—á–∞ 19: –û–±—Ä–∞–±–æ—Ç–∫–∞ CORS
- [ ] **19.1** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS headers –≤ API routes
- [ ] **19.2** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å allowed origins —Ç–æ–ª—å–∫–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- [ ] **19.3** –ó–∞–ø—Ä–µ—Ç–∏—Ç—å credentials –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API

---

## üîç –§–ê–ó–ê 5: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ó–∞–¥–∞—á–∞ 20: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] **20.1** –ó–∞–ø—É—Å—Ç–∏—Ç—å npm audit:
  ```bash
  npm audit --audit-level high
  ```
- [ ] **20.2** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å ESLint security plugin:
  ```bash
  npm install --save-dev eslint-plugin-security
  ```
- [ ] **20.3** –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ–∫—Ä–µ—Ç—ã —Å –ø–æ–º–æ—â—å—é git-secrets –∏–ª–∏ truffleHog

### –ó–∞–¥–∞—á–∞ 21: –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] **21.1** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] **21.2** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ RLS
- [ ] **21.3** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á –∏–º–µ–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
- [ ] **21.4** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Auth –≤ Supabase Dashboard

### –ó–∞–¥–∞—á–∞ 22: –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] **22.1** ‚úÖ –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] **22.2** ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö  
- [ ] **22.3** ‚úÖ JWT –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints
- [ ] **22.4** ‚úÖ Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] **22.5** ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod
- [ ] **22.6** ‚úÖ Security headers –≤ middleware
- [ ] **22.7** ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] **22.8** ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Ö–∞—Ä–¥–∫–æ–¥–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
- [ ] **22.9** ‚úÖ Service role –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] **22.10** ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ –≤—Å–µ—Ö API

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è .env.local

–î–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env.local`:

```env
# –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# –ù–æ–≤—ã–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
JWT_SECRET=generate_strong_random_secret_for_jwt_verification
RATE_LIMIT_SECRET=generate_secret_for_rate_limiting
UPSTASH_REDIS_REST_URL=your_redis_url_for_rate_limiting
UPSTASH_REDIS_REST_TOKEN=your_redis_token_for_rate_limiting

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
NODE_ENV=production
NEXTAUTH_SECRET=generate_strong_random_secret_for_auth
NEXTAUTH_URL=https://yourdomain.com
```

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### ‚ùå –ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–¢–¨:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å service_role –∫–ª—é—á –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ
- –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å API –∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã
- –û—Ç–∫–ª—é—á–∞—Ç—å RLS –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –î–æ–≤–µ—Ä—è—Ç—å –≤—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å rate limiting –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö API

### ‚úÖ –í–°–ï–ì–î–ê –î–ï–õ–ê–¢–¨:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å JWT —Ç–æ–∫–µ–Ω—ã –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Zod
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ RLS

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [Supabase RLS Documentation](https://supabase.com/docs/guides/auth/row-level-security)
- [Next.js Security Headers](https://nextjs.org/docs/advanced-features/security-headers)
- [Zod Validation](https://zod.dev/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

---

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –û—Ç–º–µ—á–∞–π—Ç–µ –∫–∞–∂–¥—É—é –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –≥–∞–ª–æ—á–∫–æ–π ‚úÖ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–π. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º - –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏—Ö –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Å –ø–æ–º–µ—Ç–∫–æ–π "‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê". 